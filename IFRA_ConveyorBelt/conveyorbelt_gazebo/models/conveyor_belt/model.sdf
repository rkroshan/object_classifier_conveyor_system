<?xml version="1.0" ?>

<!--

# ===================================== COPYRIGHT ===================================== #
#                                                                                       #
#  IFRA (Intelligent Flexible Robotics and Assembly) Group, CRANFIELD UNIVERSITY        #
#  Created on behalf of the IFRA Group at Cranfield University, United Kingdom          #
#  E-mail: IFRA@cranfield.ac.uk                                                         #
#                                                                                       #
#  Licensed under the Apache-2.0 License.                                               #
#  You may not use this file except in compliance with the License.                     #
#  You may obtain a copy of the License at: http://www.apache.org/licenses/LICENSE-2.0  #
#                                                                                       #
#  Unless required by applicable law or agreed to in writing, software distributed      #
#  under the License is distributed on an "as-is" basis, without warranties or          #
#  conditions of any kind, either express or implied. See the License for the specific  #
#  language governing permissions and limitations under the License.                    #
#                                                                                       #
#  IFRA Group - Cranfield University                                                    #
#  AUTHORS: Mikel Bueno Viso - Mikel.Bueno-Viso@cranfield.ac.uk                         #
#           Dr. Seemal Asif  - s.asif@cranfield.ac.uk                                   #
#           Prof. Phil Webb  - p.f.webb@cranfield.ac.uk                                 #
#                                                                                       #
#  Date: June, 2023.                                                                    #
#                                                                                       #
# ===================================== COPYRIGHT ===================================== #

# ===================================== COPYRIGHT ===================================== #
#                                                                                       #
#  The CAD file of the ConveyorBelt has been taken from the rokokoo/conveyor_demo ROS2  #
#  package. The .urdf file has been converted to a Gazebo model (.srdf).                #                                                                  
#                                                                                       #
#  Copyright (C) 2021, GitHub/rokokoo                                                   #                                    
#                                                                                       #
# ===================================== COPYRIGHT ===================================== #

# ======= CITE OUR WORK ======= #
# You can cite our work with the following statement:
# IFRA-Cranfield (2023) Gazebo-ROS2 Conveyor Belt Plugin. URL: https://github.com/IFRA-Cranfield/IFRA_ConveyorBelt.

-->

<sdf version="1.4">

    <model name="conveyor_belt">
        <model name="conveyorbelt_fixed">

            <static>true</static>
            <link name="belt_visual">
                <inertial>
                    <mass>100.0</mass>
                    <inertia>                        <!-- inertias are tricky to compute -->
                        <!-- http://gazebosim.org/tutorials?tut=inertia&cat=build_robot -->
                        <ixx>45.152</ixx>                        <!-- for a box: ixx = 0.083 * mass * (y*y + z*z) -->
                        <ixy>0.0</ixy>                        <!-- for a box: ixy = 0 -->
                        <ixz>0.0</ixz>                        <!-- for a box: ixz = 0 -->
                        <iyy>14.027</iyy>                        <!-- for a box: iyy = 0.083 * mass * (x*x + z*z) -->
                        <iyz>0.0</iyz>                        <!-- for a box: iyz = 0 -->
                        <izz>35.275</izz>                        <!-- for a box: izz = 0.083 * mass * (x*x + y*y) -->
                    </inertia>
                </inertial>
                <collision name="collision">
                    <geometry>
                        <box>
                            <size>0.5 4 1.2</size>
                        </box>
                    </geometry>
                </collision>
                <visual name="visual">
                    <geometry>
                        <box>
                            <size>0.5 4 1.2</size>
                        </box>
                    </geometry>
                    <material>
                        <ambient>0 0 0 0</ambient>
                        <diffuse>0 0 0 1</diffuse>
                        <specular>0.2 0.2 0.2 64</specular>
                        <emissive>0.1 0 0.1 1</emissive>
                    </material>
                </visual>
            </link>

            <link name="belt_left_visual">
            <pose>-1.25 0 0 0 0 1.57</pose>
                <inertial>
                    <mass>100.0</mass>
                    <inertia>                        <!-- inertias are tricky to compute -->
                        <!-- http://gazebosim.org/tutorials?tut=inertia&cat=build_robot -->
                        <ixx>45.152</ixx>                        <!-- for a box: ixx = 0.083 * mass * (y*y + z*z) -->
                        <ixy>0.0</ixy>                        <!-- for a box: ixy = 0 -->
                        <ixz>0.0</ixz>                        <!-- for a box: ixz = 0 -->
                        <iyy>14.027</iyy>                        <!-- for a box: iyy = 0.083 * mass * (x*x + z*z) -->
                        <iyz>0.0</iyz>                        <!-- for a box: iyz = 0 -->
                        <izz>35.275</izz>                        <!-- for a box: izz = 0.083 * mass * (x*x + y*y) -->
                    </inertia>
                </inertial>
                <collision name="collision">
                    <geometry>
                        <box>
                            <size>0.5 2 1.2</size>
                        </box>
                    </geometry>
                </collision>
                <visual name="visual">
                    <geometry>
                        <box>
                            <size>0.5 2 1.2</size>
                        </box>
                    </geometry>
                    <material>
                        <ambient>0 0 0 0</ambient>
                        <diffuse>0 0 0 1</diffuse>
                        <specular>0.2 0.2 0.2 64</specular>
                        <emissive>0.1 0 0.1 1</emissive>
                    </material>
                </visual>
            </link>

            <link name="belt_right_visual">
            <pose>1.25 1 0 0 0 1.57</pose>
                <inertial>
                    <mass>100.0</mass>
                    <inertia>                        <!-- inertias are tricky to compute -->
                        <!-- http://gazebosim.org/tutorials?tut=inertia&cat=build_robot -->
                        <ixx>45.152</ixx>                        <!-- for a box: ixx = 0.083 * mass * (y*y + z*z) -->
                        <ixy>0.0</ixy>                        <!-- for a box: ixy = 0 -->
                        <ixz>0.0</ixz>                        <!-- for a box: ixz = 0 -->
                        <iyy>14.027</iyy>                        <!-- for a box: iyy = 0.083 * mass * (x*x + z*z) -->
                        <iyz>0.0</iyz>                        <!-- for a box: iyz = 0 -->
                        <izz>35.275</izz>                        <!-- for a box: izz = 0.083 * mass * (x*x + y*y) -->
                    </inertia>
                </inertial>
                <collision name="collision">
                    <geometry>
                        <box>
                            <size>0.5 2 1.2</size>
                        </box>
                    </geometry>
                </collision>
                <visual name="visual">
                    <geometry>
                        <box>
                            <size>0.5 2 1.2</size>
                        </box>
                    </geometry>
                    <material>
                        <ambient>0 0 0 0</ambient>
                        <diffuse>0 0 0 1</diffuse>
                        <specular>0.2 0.2 0.2 64</specular>
                        <emissive>0.1 0 0.1 1</emissive>
                    </material>
                </visual>
            </link>
        </model>

        <model name="belt_changer">
            <static>true</static>
            <link name="belt_changer_left">
            <pose>0.55 0 0 0 0 0</pose>
                <inertial>
                    <mass>100.0</mass>
                    <inertia>                        <!-- inertias are tricky to compute -->
                        <!-- http://gazebosim.org/tutorials?tut=inertia&cat=build_robot -->
                        <ixx>0</ixx>                        <!-- for a box: ixx = 0.083 * mass * (y*y + z*z) -->
                        <ixy>0.0</ixy>                        <!-- for a box: ixy = 0 -->
                        <ixz>0.0</ixz>                        <!-- for a box: ixz = 0 -->
                        <iyy>0</iyy>                        <!-- for a box: iyy = 0.083 * mass * (x*x + z*z) -->
                        <iyz>0.0</iyz>                        <!-- for a box: iyz = 0 -->
                        <izz>0</izz>                        <!-- for a box: izz = 0.083 * mass * (x*x + y*y) -->
                    </inertia>
                </inertial>
                <collision name="collision">
                    <geometry>
                        <box>
                            <size>0.6 0.5 1.2</size>
                        </box>
                    </geometry>
                </collision>
                <visual name="visual">
                    <geometry>
                        <box>
                            <size>0.6 0.5 1.2</size>
                        </box>
                    </geometry>
                    <material>
                        <ambient>0 0 0 0</ambient>
                        <diffuse>0 1 1 1</diffuse>
                        <specular>0.3 0.3 0.2 64</specular>
                        <emissive>0.1 0 0.1 1</emissive>
                    </material>
                </visual>
            </link>

            <link name="belt_changer_right">
            <pose>-0.55 1 0 0 0 0</pose>
                <inertial>
                    <mass>100.0</mass>
                    <inertia>                        <!-- inertias are tricky to compute -->
                        <!-- http://gazebosim.org/tutorials?tut=inertia&cat=build_robot -->
                        <ixx>0</ixx>                        <!-- for a box: ixx = 0.083 * mass * (y*y + z*z) -->
                        <ixy>0.0</ixy>                        <!-- for a box: ixy = 0 -->
                        <ixz>0.0</ixz>                        <!-- for a box: ixz = 0 -->
                        <iyy>0</iyy>                        <!-- for a box: iyy = 0.083 * mass * (x*x + z*z) -->
                        <iyz>0.0</iyz>                        <!-- for a box: iyz = 0 -->
                        <izz>0</izz>                        <!-- for a box: izz = 0.083 * mass * (x*x + y*y) -->
                    </inertia>
                </inertial>
                <collision name="collision">
                    <geometry>
                        <box>
                            <size>0.6 0.5 1.2</size>
                        </box>
                    </geometry>
                </collision>
                <visual name="visual">
                    <geometry>
                        <box>
                            <size>0.6 0.5 1.2</size>
                        </box>
                    </geometry>
                    <material>
                        <ambient>0 0 0 0</ambient>
                        <diffuse>0 1 1 1</diffuse>
                        <specular>0.3 0.3 0.2 64</specular>
                        <emissive>0.1 0 0.1 1</emissive>
                    </material>
                </visual>
            </link>
        </model>

        <model name="belt_changer_moving">

            <allow_auto_disable>0</allow_auto_disable>
            <static>false</static>

            <link name="belt_changer_left_moving">
            <pose>0.55 0 0.71 0 0 0</pose>
                <inertial>
                    <mass>100.0</mass>
                    <inertia>
                        <ixx>0.0</ixx>
                        <ixy>0.0</ixy>
                        <ixz>0.0</ixz>
                        <iyy>0.0</iyy>
                        <iyz>0.0</iyz>
                        <izz>0.0</izz>
                    </inertia>
                </inertial>
                <collision name="belt_collision">
                    <geometry>
                        <box>
                            <size>0.6 0.2 0.2</size>
                        </box>
                    </geometry>
                    <surface>
                        <friction>
                            <ode>
                                <mu>100.0</mu>
                                <mu2>100.0</mu2>
                            </ode>
                            <torsional>
                                <coefficient>1000.0</coefficient>
                                <patch_radius>0.1</patch_radius>
                            </torsional>
                        </friction>
                    </surface>
                </collision>

                <visual name="belt_left_visual">
                    <geometry>
                        <box>
                            <size>0.6 0.2 0.2</size>
                        </box>
                    </geometry>
                </visual>

            </link>

            <link name="belt_changer_right_moving">
            <pose>-0.55 1 0.71 0 0 0</pose>
                <inertial>
                    <mass>100.0</mass>
                    <inertia>
                        <ixx>0.0</ixx>
                        <ixy>0.0</ixy>
                        <ixz>0.0</ixz>
                        <iyy>0.0</iyy>
                        <iyz>0.0</iyz>
                        <izz>0.0</izz>
                    </inertia>
                </inertial>
                <collision name="belt_collision">
                    <geometry>
                        <box>
                            <size>0.6 0.2 0.2</size>
                        </box>
                    </geometry>
                    <surface>
                        <friction>
                            <ode>
                                <mu>100.0</mu>
                                <mu2>100.0</mu2>
                            </ode>
                            <torsional>
                                <coefficient>1000.0</coefficient>
                                <patch_radius>0.1</patch_radius>
                            </torsional>
                        </friction>
                    </surface>
                </collision>

                <visual name="belt_right_visual">
                    <geometry>
                        <box>
                            <size>0.6 0.2 0.2</size>
                        </box>
                    </geometry>
                </visual>

            </link>

        </model>

        <model name="conveyorbelt_moving">

            <allow_auto_disable>0</allow_auto_disable>
            <static>false</static>

            <link name="belt_moving">
            <pose>0 0 0.6 0 0 0.0</pose>
                <inertial>
                    <mass>100.0</mass>
                    <inertia>
                        <ixx>0.0</ixx>
                        <ixy>0.0</ixy>
                        <ixz>0.0</ixz>
                        <iyy>0.0</iyy>
                        <iyz>0.0</iyz>
                        <izz>0.0</izz>
                    </inertia>
                </inertial>
                <collision name="belt_collision">
                    <geometry>
                        <box>
                            <size>0.425 4 0.00001</size>
                        </box>
                    </geometry>
                    <surface>
                        <friction>
                            <ode>
                                <mu>100.0</mu>
                                <mu2>100.0</mu2>
                            </ode>
                            <torsional>
                                <coefficient>1000.0</coefficient>
                                <patch_radius>0.1</patch_radius>
                            </torsional>
                        </friction>
                    </surface>
                </collision>

                <visual name="belt_visual">
                    <geometry>
                        <box>
                            <size>0.425 4 0.001</size>
                        </box>
                    </geometry>
                </visual>

            </link>

            <link name="belt_left_moving">
            <pose>-1.25 0 0.6 0 0 1.57</pose>
                <inertial>
                    <mass>100.0</mass>
                    <inertia>
                        <ixx>0.0</ixx>
                        <ixy>0.0</ixy>
                        <ixz>0.0</ixz>
                        <iyy>0.0</iyy>
                        <iyz>0.0</iyz>
                        <izz>0.0</izz>
                    </inertia>
                </inertial>
                <collision name="belt_collision">
                    <geometry>
                        <box>
                            <size>0.425 2 0.00001</size>
                        </box>
                    </geometry>
                    <surface>
                        <friction>
                            <ode>
                                <mu>100.0</mu>
                                <mu2>100.0</mu2>
                            </ode>
                            <torsional>
                                <coefficient>1000.0</coefficient>
                                <patch_radius>0.1</patch_radius>
                            </torsional>
                        </friction>
                    </surface>
                </collision>

                <visual name="belt_left_visual">
                    <geometry>
                        <box>
                            <size>0.425 2 0.001</size>
                        </box>
                    </geometry>
                </visual>

            </link>

            <link name="belt_right_moving">
            <pose>1.25 1 0.6 0 0 1.57</pose>
                <inertial>
                    <mass>100.0</mass>
                    <inertia>
                        <ixx>0.0</ixx>
                        <ixy>0.0</ixy>
                        <ixz>0.0</ixz>
                        <iyy>0.0</iyy>
                        <iyz>0.0</iyz>
                        <izz>0.0</izz>
                    </inertia>
                </inertial>
                <collision name="belt_collision">
                    <geometry>
                        <box>
                            <size>0.425 2 0.00001</size>
                        </box>
                    </geometry>
                    <surface>
                        <friction>
                            <ode>
                                <mu>100.0</mu>
                                <mu2>100.0</mu2>
                            </ode>
                            <torsional>
                                <coefficient>1000.0</coefficient>
                                <patch_radius>0.1</patch_radius>
                            </torsional>
                        </friction>
                    </surface>
                </collision>

                <visual name="belt_right_visual">
                    <geometry>
                        <box>
                            <size>0.425 2 0.001</size>
                        </box>
                    </geometry>
                </visual>

            </link>

        </model>

        <joint name="belt_changer_left_joint" type="prismatic">
            <parent>belt_changer::belt_changer_left</parent>
            <child>belt_changer_moving::belt_changer_left_moving</child>
            <axis>
                <xyz>-1 0 0</xyz>
                <limit>
                    <lower>0.0</lower>
                    <upper>0.5</upper>
                </limit>
            </axis>
        </joint>

        <joint name="belt_changer_right_joint" type="prismatic">
            <parent>belt_changer::belt_changer_right</parent>
            <child>belt_changer_moving::belt_changer_right_moving</child>
            <axis>
                <xyz>1 0 0</xyz>
                <limit>
                    <lower>0.0</lower>
                    <upper>0.5</upper>
                </limit>
            </axis>
        </joint>

        <joint name="belt_joint" type="prismatic">
            <parent>conveyorbelt_fixed::belt_visual</parent>
            <child>conveyorbelt_moving::belt_moving</child>
            <axis>
                <xyz>0 1 0</xyz>
                <limit>
                    <lower>0.0</lower>
                    <upper>0.02</upper>
                </limit>
            </axis>
        </joint>

        <joint name="belt_left_joint" type="prismatic">
            <parent>conveyorbelt_fixed::belt_left_visual</parent>
            <child>conveyorbelt_moving::belt_left_moving</child>
            <axis>
                <xyz>-1 0 0</xyz>
                <limit>
                    <lower>0.0</lower>
                    <upper>0.01</upper>
                </limit>
            </axis>
        </joint>

        <joint name="belt_right_joint" type="prismatic">
            <parent>conveyorbelt_fixed::belt_right_visual</parent>
            <child>conveyorbelt_moving::belt_right_moving</child>
            <axis>
                <xyz>1 0 0</xyz>
                <limit>
                    <lower>0.0</lower>
                    <upper>0.01</upper>
                </limit>
            </axis>
        </joint>

        <plugin name="ros2_conveyorbelt_plugin" filename="libros2_conveyorbelt_plugin.so">
            <ros>
                <namespace></namespace>
            </ros>
            <max_velocity>1.0</max_velocity>
            <belt_changer_velocity>0.3</belt_changer_velocity>
            <publish_rate>1000</publish_rate>
        </plugin>

    </model>

</sdf>